# Исправление навигации после онбординга

## Проблема

После завершения онбординга и нажатия кнопки "Continue" происходила долгая загрузка, и приложение не переводило пользователя на домашнюю страницу. Переход происходил только после обновления приложения через терминал Expo.

## Причина

1. **Порядок обновления состояния**: В `SettingsProvider` состояние обновлялось только после успешного сохранения в AsyncStorage, что вызывало задержку
2. **Отсутствие программной навигации**: `RootNavigator` использовал только `initialRouteName`, который устанавливается один раз при создании навигатора и не реагирует на изменения `isOnboarded`

## Решение

### 1. Оптимистичное обновление состояния

Изменен порядок операций в `persist` функциях:
- **Было**: Сначала сохранение в storage → потом обновление состояния
- **Стало**: Сначала обновление состояния в памяти → потом сохранение в storage

Это обеспечивает мгновенное обновление UI и быструю реакцию навигации.

### 2. Программная навигация в OnboardingScreen

Добавлен `useEffect` в `OnboardingScreen`, который отслеживает изменение `settings.isOnboarded` и автоматически навигирует на Home screen:

```typescript
useEffect(() => {
  if (settings.isOnboarded) {
    const timer = setTimeout(() => {
      navigation.reset({
        index: 0,
        routes: [{ name: 'Home' }],
      });
    }, 300);
    return () => clearTimeout(timer);
  }
  return undefined;
}, [settings.isOnboarded, navigation]);
```

### 3. Использование navigation.reset

Вместо `navigation.replace()` используется `navigation.reset()` для полной очистки стека навигации и перехода на Home screen.

## Измененные файлы

- `src/state/SettingsProvider.tsx` - Оптимистичное обновление состояния
- `src/state/TransactionsProvider.tsx` - Оптимистичное обновление состояния
- `src/screens/OnboardingScreen.tsx` - Добавлена программная навигация

## Результат

- Мгновенное обновление UI после сохранения
- Автоматическая навигация на Home screen без задержек
- Нет необходимости в ручном обновлении приложения

## Тестирование

1. Запустите приложение
2. Пройдите онбординг
3. Нажмите "Continue"
4. Должен произойти автоматический переход на Home screen в течение ~300ms

